name: Daily Random Commit

on:
  schedule:
    - cron: "0 10 * * *"   # 每天 UTC 10:00 (北京时间 18:00) 固定触发
  workflow_dispatch:       # 支持手动运行

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Git
        run: |
          git config --global user.name "jvbaoge1"
          git config --global user.email "shhshz1@163.com "   # 改成你绑定的邮箱

      - name: Random wait (skip if manual)
        run: |
          if [ "${{ github.event_name }}" = "schedule" ]; then
            # 随机等待 0 ~ 5 小时（18:00 ~ 23:00）
            MINUTES=$((RANDOM % 301))
            echo "⏳ 等待 $MINUTES 分钟再提交..."
            sleep ${MINUTES}m
          else
            echo "手动触发 → 跳过等待"
          fi

      - name: Generate random pseudo code
        run: |
          # 随机生成文件名 + 类型
          PREFIXES=("notes" "data" "script" "update" "log" "config" "test" "random")
          EXTENSIONS=("txt" "md" "js" "py" "c" "cpp" "sh" "json")
          FILE="${PREFIXES[$RANDOM % ${#PREFIXES[@]}]}.${EXTENSIONS[$RANDOM % ${#EXTENSIONS[@]}]}"

          echo "✍️ 本次写入文件: $FILE"
          echo "// Commit at $(date)" >> $FILE

          # 随机生成 3~8 行伪代码
          LINES=$(( (RANDOM % 6) + 3 ))
          for i in $(seq 1 $LINES); do
            case $((RANDOM % 6)) in
              0) echo "function auto_${RANDOM}() { return $RANDOM; }" >> $FILE ;;
              1) echo "let var_${RANDOM} = ${RANDOM};" >> $FILE ;;
              2) echo "if (x == ${RANDOM}) { y = ${RANDOM}; }" >> $FILE ;;
              3) echo "console.log('Debug ${RANDOM}');" >> $FILE ;;
              4) echo "#define VAL_${RANDOM} ${RANDOM}" >> $FILE ;;
              5) echo "{ \"id\": ${RANDOM}, \"val\": ${RANDOM} }" >> $FILE ;;
            esac
          done

          echo "" >> $FILE

      - name: Commit changes
        run: |
          # 随机挑选 commit message
          MESSAGES=("update notes" "fix script" "add new data" "refactor code" "update log" "random commit" "improve config" "test changes")
          COMMIT_MSG=${MESSAGES[$RANDOM % ${#MESSAGES[@]}]}

          git add .
          git commit -m "$COMMIT_MSG at $(date)" || echo "Nothing to commit"
          git push



