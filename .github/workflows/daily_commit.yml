name: Daily Random Commit

on:
  schedule:
    - cron: "0 10 * * *"   # ÊØèÂ§© UTC 10:00 Ëß¶ÂèëÔºàÂåó‰∫¨Êó∂Èó¥ 18:00Ôºâ
  workflow_dispatch:        # ÊâãÂä®Ëß¶ÂèëÊåâÈíÆ

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Set up Git
        run: |
          git config --global user.name "jvbaoge1"   # Êç¢Êàê‰Ω†ÁöÑ GitHub Áî®Êà∑Âêç
          git config --global user.email "shhshz1@163.com"
          # ‚Üë ËøôÈáåË¶ÅÊç¢Êàê‰Ω†Âú® GitHub Settings ‚Üí Emails ÈáåÁúãÂà∞ÁöÑÈÇÆÁÆ±
          # Â¶ÇÊûú‰Ω†ÊÉ≥Áî®ÁúüÂÆûÈÇÆÁÆ±ÔºàÊØîÂ¶Ç abc@gmail.comÔºâÔºå‰πüÂèØ‰ª•ÂÜôÁúüÂÆûÈÇÆÁÆ±

      - name: Decide whether to wait
        run: |
          if [[ "${{ github.event_name }}" == "workflow_dispatch" ]]; then
            echo "ÊâãÂä®Ëß¶Âèë ‚Üí Ë∑≥ËøáÁ≠âÂæÖÔºåÁ´ãÂç≥Êèê‰∫§ üöÄ"
          else
            RANDOM_HOUR=$(( RANDOM % 6 ))
            RANDOM_MIN=$(( RANDOM % 60 ))
            TOTAL_SEC=$(( RANDOM_HOUR*3600 + RANDOM_MIN*60 ))
            echo "‚è≥ ÂÆöÊó∂Ëß¶Âèë ‚Üí Á≠âÂæÖ $RANDOM_HOUR Â∞èÊó∂ $RANDOM_MIN ÂàÜÈíüÂêéÊèê‰∫§"
            sleep $TOTAL_SEC
          fi

      - name: Generate pseudo code & update README
        run: |
          NOW=$(date '+%Y-%m-%d %H:%M:%S')
          echo "" >> README.md
          echo "## Daily Commit - $NOW" >> README.md

          NUM_PARAGRAPHS=$(( (RANDOM % 4) + 2 ))
          for ((p=1; p<=NUM_PARAGRAPHS; p++))
          do
            echo "" >> README.md
            echo "- [${NOW}] Pseudo code paragraph $p:" >> README.md

            NUM_LINES=$(( (RANDOM % 4) + 2 ))
            for ((i=1; i<=NUM_LINES; i++))
            do
              VAR="var$((RANDOM % 100))"
              FUNC="func$((RANDOM % 50))"
              NUM=$((RANDOM % 100))
              echo "  $VAR = $FUNC($NUM)" >> README.md
            done

            EMOJIS=("‚ú®" "üî•" "üöÄ" "üêõ" "‚úÖ" "üîß" "üì¶" "üìù" "üí°" "üéâ")
            LOGS=("‰ºòÂåñ‰∫Ü‰ª£Á†Å" "‰øÆÂ§ç‰∫Ü‰∏Ä‰∏™Â∞èÈóÆÈ¢ò" "Êñ∞Â¢û‰∫ÜÂäüËÉΩ" "ÊîπËøõ‰∫ÜÊÄßËÉΩ" "Êï¥ÁêÜ‰∫ÜÊ≥®Èáä" "Êõ¥Êñ∞‰∫ÜÈÄªËæë")
            RAND_EMOJI=${EMOJIS[$RANDOM % ${#EMOJIS[@]}]}
            RAND_LOG=${LOGS[$RANDOM % ${#LOGS[@]}]}
            echo "  Note: $RAND_LOG $RAND_EMOJI" >> README.md
          done

      - name: Commit & Push changes
        run: |
          git add README.md
          git commit -m "chore: daily update $(date '+%Y-%m-%d %H:%M:%S')" || echo "‚ö†Ô∏è Nothing to commit"
          git pull --rebase origin main || true
          git push origin main || echo "‚ö†Ô∏è Push failed"

