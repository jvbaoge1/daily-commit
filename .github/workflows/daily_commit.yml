name: Daily Random Commit

on:
  schedule:
    - cron: "0 10 * * *"   # æ¯å¤© UTC 10:00 è§¦å‘ï¼ˆåŒ—äº¬æ—¶é—´ 18:00ï¼‰
  workflow_dispatch:        # æ‰‹åŠ¨è§¦å‘æŒ‰é’®

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Set up Git
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"

      - name: Decide whether to wait
        run: |
          if [[ "${{ github.event_name }}" == "workflow_dispatch" ]]; then
            echo "æ‰‹åŠ¨è§¦å‘ â†’ è·³è¿‡ç­‰å¾…ï¼Œç«‹å³æäº¤ ğŸš€"
          else
            RANDOM_HOUR=$(( RANDOM % 6 ))
            RANDOM_MIN=$(( RANDOM % 60 ))
            TOTAL_SEC=$(( RANDOM_HOUR*3600 + RANDOM_MIN*60 ))
            echo "â³ å®šæ—¶è§¦å‘ â†’ ç­‰å¾… $RANDOM_HOUR å°æ—¶ $RANDOM_MIN åˆ†é’Ÿåæäº¤"
            sleep $TOTAL_SEC
          fi

      - name: Generate pseudo code & update README
        run: |
          NOW=$(date '+%Y-%m-%d %H:%M:%S')
          echo "" >> README.md
          echo "## Daily Commit - $NOW" >> README.md

          # éšæœºç”Ÿæˆ 2~5 æ®µä¼ªä»£ç 
          NUM_PARAGRAPHS=$(( (RANDOM % 4) + 2 ))
          for ((p=1; p<=NUM_PARAGRAPHS; p++))
          do
            echo "" >> README.md
            echo "- [${NOW}] Pseudo code paragraph $p:" >> README.md

            # æ¯æ®µ 2~5 è¡Œä¼ªä»£ç 
            NUM_LINES=$(( (RANDOM % 4) + 2 ))
            for ((i=1; i<=NUM_LINES; i++))
            do
              VAR="var$((RANDOM % 100))"
              FUNC="func$((RANDOM % 50))"
              NUM=$((RANDOM % 100))
              echo "  $VAR = $FUNC($NUM)" >> README.md
            done

            # éšæœºæ—¥å¿— + emoji
            EMOJIS=("âœ¨" "ğŸ”¥" "ğŸš€" "ğŸ›" "âœ…" "ğŸ”§" "ğŸ“¦" "ğŸ“" "ğŸ’¡" "ğŸ‰")
            LOGS=("ä¼˜åŒ–äº†ä»£ç " "ä¿®å¤äº†ä¸€ä¸ªå°é—®é¢˜" "æ–°å¢äº†åŠŸèƒ½" "æ”¹è¿›äº†æ€§èƒ½" "æ•´ç†äº†æ³¨é‡Š" "æ›´æ–°äº†é€»è¾‘")
            RAND_EMOJI=${EMOJIS[$RANDOM % ${#EMOJIS[@]}]}
            RAND_LOG=${LOGS[$RANDOM % ${#LOGS[@]}]}
            echo "  Note: $RAND_LOG $RAND_EMOJI" >> README.md
          done

      - name: Commit & Push changes
        run: |
          git add README.md
          git commit -m "chore: daily update $(date '+%Y-%m-%d %H:%M:%S')" || echo "âš ï¸ Nothing to commit"
          git pull --rebase origin main || true
          git push origin main || echo "âš ï¸ Push failed"
